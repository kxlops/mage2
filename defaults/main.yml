---
# Vagrant
############################

kxlops_mage2_vagrant_host_sync_path: ./
kxlops_mage2_vagrant_guest_sync_path: /home/vagrant/workspace

kxlops_mage2_link_build_dir: false
kxlops_mage2_link_server_from_path: '{{ kxlops_mage2_vagrant_guest_sync_path }}/_builds/{{ kxlops_mage2_build_dir }}/{{ kxlops_mage2_app_root }}'
kxlops_mage2_link_server_to_path: '{{ kxlops_mage2_documentroot }}/{{ kxlops_mage2_app_root }}'

kxlops_mage2_install_devtools: false

# Setup
############################

kxlops_mage2_post_update_config_yml:
  - { regexp: '^kxlops_mage2_setup_complete', line: "kxlops_mage2_setup_complete: true" }

# Provision
############################

# Apache Pre-fork
kxlops_mage2_httpd_mpm_serverlimit: 30
kxlops_mage2_httpd_mpm_startservers: 15
kxlops_mage2_httpd_mpm_minsparethreads: 30
kxlops_mage2_httpd_mpm_maxsparethreads: 60
kxlops_mage2_httpd_mpm_threadlimit: 60
kxlops_mage2_httpd_mpm_threadsperchild: 15
kxlops_mage2_httpd_mpm_maxrequestworkers: 30
kxlops_mage2_httpd_mpm_maxconnectionsperchild: 1000

# CORS
kxlops_mage2_httpd_cors_orgin: "*"
kxlops_mage2_httpd_cors_file_match: ".(eot|ttf|otf|woff)"

# WEB server
############################

kxlops_mage2_role_hostname: "magento-{{ kxlops_mage2_env }}-{{ kxlops_mage2_role }}.{{ kxlops_mage2_app_base_domain }}"

kxlops_mage2_documentroot: /var/www/mage2
kxlops_mage2_app_root: shop # no leading slash
kxlops_mage2_app_fqdn: www-local.magento2site.com

# http config
kxlops_mage2_http_conf: /etc/httpd/conf/httpd.conf

# http user and groups
kxlops_mage2_target_server_group: apache
kxlops_mage2_target_user: ec2-user
kxlops_mage2_target_group: apache

# Mage2 env.php
############################

kxlops_mage2_template_env_php: env.php.j2
kxlops_mage2_template_env_php_custom: # @TODO - not implemented yet
kxlops_mage2_env_php_path: '{{ kxlops_mage2_build_target_install_path }}/app/etc/env.php'

kxlops_mage2_env_backend_frontname: manageShop

kxlops_mage2_env_mage_mode: production

kxlops_mage2_env_crypt_key: 123456789011223344556677889900

kxlops_mage2_env_install_date: Fri, 16 Feb 2018 21:33:15 +0000

kxlops_mage2_env_catalog_elasticsearch_index : "local-{{ kxlops_mage2_unique_id }}"

# DB settings main
kxlops_mage2_env_split_db_enable: false

kxlops_mage2_env_db_host_main: localhost
kxlops_mage2_env_db_main: mage2
kxlops_mage2_env_db_user_main: root
kxlops_mage2_env_db_password_main: ""

# DB settings sales (for split db)
kxlops_mage2_env_db_host_sales: localhost
kxlops_mage2_env_db_sales: mage2
kxlops_mage2_env_db_user_sales: root
kxlops_mage2_env_db_password_sales: ""

# DB settings quote (for split db)
kxlops_mage2_env_db_host_quote: localhost
kxlops_mage2_env_db_quote: mage2
kxlops_mage2_env_db_user_quote: root
kxlops_mage2_env_db_password_quote: ""


# Mage2 config.php
#################################

kxlops_mage2_template_config_php: config.php.j2

kxlops_mage2_template_config_php_custom:
kxlops_mage2_config_php_path: '{{ kxlops_mage2_build_target_install_path }}/app/etc/config.php'

# Mage2 composer.json
#################################

kxlops_mage2_template_composer_json: composer.json.j2
kxlops_mage2_template_composer_json_custom:
kxlops_mage2_composer_json_path: '{{ kxlops_mage2_build_target_install_path }}/composer.json'

# Build
####################################

# If we are delegating to localhost then use local home directory, otherwise use remotes home directory
kxlops_mage2_builder_home_path: "/home/ec2-user"

kxlops_mage2_datapush: []

kxlops_mage2_build_full_path: /var/www/mage2

kxlops_mage2_deploy_dir: mage2

kxlops_mage2_build_remove_build: true
kxlops_mage2_build_unarchive_release: true

kxlops_mage2_build_link_media: false

# location where deployment artifact is created from

kxlops_mage2_build_delegate_to: localhost
kxlops_mage2_build_target_local: true

kxlops_mage2_build_target_base_path: '{{ ( kxlops_mage2_build_target_local ) | ternary( kxlops_mage2_build_local_base_path, kxlops_mage2_build_server_base_path ) }}'
kxlops_mage2_build_target_install_path: '{{ ( kxlops_mage2_build_target_local ) | ternary( kxlops_mage2_build_local_install_path, kxlops_mage2_build_server_install_path ) }}'

# artifact build install (target = local) - deployed
kxlops_mage2_build_local_base_path: '{{ kxlops_workspace_base_path }}/_builds/{{ kxlops_mage2_build_dir }}'
kxlops_mage2_build_local_install_path: '{{ kxlops_mage2_build_local_base_path }}/{{ kxlops_mage2_app_root }}'

# direct server build install (target = remote)
kxlops_mage2_build_server_base_path: '{{ kxlops_mage2_documentroot }}'
kxlops_mage2_build_server_install_path: '{{ kxlops_mage2_build_server_base_path }}/{{ kxlops_mage2_app_root }}'

kxlops_mage2_build_dir: 'mage2_{{ kxlops_workspace_env }}'
kxlops_mage2_build_artifact_file: 'mage2_{{ kxlops_workspace_env }}.zip'
kxlops_mage2_build_artifact_location: local # or S3
kxlops_mage2_build_artifact_base_path: '{{ kxlops_workspace_base_path }}/_artifacts'
kxlops_mage2_build_artifact_file_path: '{{ kxlops_mage2_build_artifact_base_path }}/{{ kxlops_mage2_build_artifact_file }}'

kxlops_mage2_build_include_files:
  - '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}/*'
  - '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}/.*'

kxlops_mage2_build_artifact_exclude_files:
#  - '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}/composer.json'
#  - '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}/composer.lock'
#  - '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_build_release_archive }}'

kxlops_mage2_build_release_archive: Magento-EE-2.2.3-2018-02-23-12-36-06.zip
kxlops_mage2_build_release_archive_location: local # or S3
kxlops_mage2_build_release_archive_base_path: '{{ role_path }}/files/releases'
# for S3 -> kxlops_mage2_build_release_archive_base_path: '{{ kxlops_workspace_base_path }}/_releases'
kxlops_mage2_build_release_archive_file_path: '{{ kxlops_mage2_build_release_archive_base_path }}/{{ kxlops_mage2_build_release_archive }}'

# magento 2 core patches
kxlops_mage2_build_core_patches_apply: true
kxlops_mage2_build_core_patches_location: local # or S3 ( though not supported yet...)
kxlops_mage2_build_core_patches_base_path: '{{ role_path }}/files/patches'
# for S3 -> kxlops_mage2_build_core_patches_base_path: '{{ kxlops_workspace_base_path }}/_patches'

kxlops_mage2_build_core_patches:
-  { strip: 1, base_path: '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}', file: 'MDVA-10441_EE_2.2.3_COMPOSER_v2.patch' }
-  { strip: 1, base_path: '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}', file: 'MDVA-12024_EE_2.2.1_COMPOSER_v1.patch' }
-  { strip: 1, base_path: '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}', file: 'MDVA-13117_EE_2.2.3_COMPOSER_v1.patch' }
-  { strip: 1, base_path: '{{ kxlops_mage2_build_target_base_path }}/{{ kxlops_mage2_app_root }}', file: 'MDVA-7996_EE_2.1.9_v1.composer.patch' }

# custom patches - @TODO implement

kxlops_mage2_build_update_composer:
#  - clearcache
  - update

kxlops_mage2_rundeck_api_url: http://10.93.200.188/rundeck

kxlops_mage2_rundeck_cron_job: 9097830d-1ada-48d3-b41a-e020a25b6ec6

kxlops_mage2_rundeck_api_token: ''

# Update
################################################

kxlops_mage2_remove_stock_triggers: false

kxlops_mage2_cmd_setup_upgrade: true
kxlops_mage2_cmd_app_config_import: false
kxlops_mage2_cmd_enable_all_modules: true
kxlops_mage2_cmd_setup_sc_deploy_timeout: 3m
kxlops_mage2_cmd_setup_sc_deploy_retries: 3
kxlops_mage2_cmd_setup_sc_deploy_delay: 1

# Post Deploy
################################################

kxlops_mage2_use_rundeck_cron: false


# Database
##################################
kxlops_mage2_db_to_import:
  - '{{ role_path }}/files/base-mage-2-2-3.sql.gz'

# Default composer template vars for composer.json
kxlops_mage2_composer_json_require:
  "composer/composer": "@alpha"
  "magento/product-enterprise-edition": "2.2.3"

kxlops_mage2_composer_json_repositories:
  -
    "type": "composer"
    "url": "https://repo.magento.com/"

# Example with more options
# Template data for config.php
#kxlops_mage2_config_php:
#  modules: '{{ kxlops_mage2_config_php_modules }}'
#  admin:
#    security:
#      session_lifetime: 86400
#  system:
#    default:
#      design:
#        theme:
#          theme_id: "'frontend/Balfour/balfour'"
#  themes:
#    frontend/Balfour/balfour:
#      parent_id: "'Magento/blank'"
#      theme_path: "'Balfour/balfour'"
#      theme_title: "'Balfour'"
#      is_featured: 0
#      area: "'frontend'"
#      type: 0
#      code: "'Balfour/balfour'"

# Default template data for config.php mage-2.2.3
###################################################
kxlops_mage2_config_php:
  modules: '{{ kxlops_mage2_config_php_modules }}'

kxlops_mage2_config_php_modules:
  Magento_Store: 1
  Magento_Directory: 1
  Magento_Theme: 1
  Magento_Eav: 1
  Magento_Customer: 1
  Magento_AdvancedPricingImportExport: 1
  Magento_Rule: 1
  Magento_AdminNotification: 1
  Magento_Backend: 1
  Magento_Amqp: 1
  Magento_Config: 1
  Magento_User: 1
  Magento_Authorization: 1
  Magento_Indexer: 1
  Magento_Cms: 1
  Magento_Backup: 1
  Magento_Catalog: 1
  Magento_Quote: 1
  Magento_CatalogInventory: 1
  Magento_Bundle: 1
  Magento_BundleImportExport: 1
  Magento_BundleImportExportStaging: 1
  Magento_CatalogUrlRewrite: 1
  Magento_CacheInvalidate: 1
  Magento_SalesSequence: 1
  Magento_Cron: 1
  Magento_Security: 1
  Magento_MediaStorage: 1
  Magento_CatalogImportExport: 1
  Magento_CatalogImportExportStaging: 1
  Magento_Payment: 1
  Magento_Ui: 1
  Magento_Search: 1
  Magento_Sales: 1
  Magento_Msrp: 1
  Magento_SalesRule: 1
  Magento_Checkout: 1
  Magento_Downloadable: 1
  Magento_GiftCard: 1
  Magento_Staging: 1
  Magento_Widget: 1
  Magento_Vault: 1
  Magento_CheckoutAgreements: 1
  Magento_CheckoutStaging: 1
  Magento_AdvancedCatalog: 1
  Magento_CmsStaging: 1
  Magento_CmsUrlRewrite: 1
  Magento_Integration: 1
  Magento_ConfigurableImportExport: 1
  Magento_ConfigurableProduct: 1
  Magento_ConfigurableProductSales: 1
  Magento_Wishlist: 1
  Magento_Contact: 1
  Magento_Cookie: 1
  Magento_Newsletter: 1
  Magento_CurrencySymbol: 1
  Magento_CustomAttributeManagement: 1
  Magento_AdvancedCheckout: 1
  Magento_Analytics: 1
  Magento_CustomerBalance: 1
  Magento_CustomerCustomAttributes: 1
  Magento_CustomerFinance: 1
  Magento_CustomerImportExport: 1
  Magento_CatalogRule: 1
  Magento_Cybersource: 1
  Magento_Deploy: 1
  Magento_Developer: 1
  Magento_Dhl: 1
  Magento_AdvancedSearch: 1
  Magento_ProductAlert: 1
  Magento_ImportExport: 1
  Magento_Reports: 1
  Magento_AdvancedRule: 1
  Magento_CatalogSearch: 1
  Magento_Email: 1
  Magento_EncryptionKey: 1
  Magento_Enterprise: 1
  Magento_Eway: 1
  Magento_Fedex: 1
  Magento_TargetRule: 1
  Magento_GiftCardAccount: 1
  Magento_GiftCardImportExport: 1
  Magento_Tax: 1
  Magento_GiftMessage: 1
  Magento_GiftMessageStaging: 1
  Magento_Weee: 1
  Magento_GiftWrapping: 1
  Magento_GiftWrappingStaging: 1
  Magento_GoogleAdwords: 1
  Magento_GoogleAnalytics: 1
  Magento_GoogleOptimizer: 1
  Magento_GoogleOptimizerStaging: 1
  Magento_PageCache: 1
  Magento_GroupedImportExport: 1
  Magento_GroupedProduct: 1
  Magento_GroupedProductStaging: 1
  Magento_DownloadableImportExport: 1
  Magento_Captcha: 1
  Magento_InstantPurchase: 1
  Magento_CatalogAnalytics: 1
  Magento_WebsiteRestriction: 1
  Magento_LayeredNavigation: 1
  Magento_LayeredNavigationStaging: 1
  Magento_Logging: 1
  Magento_Marketplace: 1
  Magento_CatalogEvent: 1
  Magento_MessageQueue: 1
  Magento_CatalogRuleConfigurable: 1
  Magento_MsrpStaging: 1
  Magento_MultipleWishlist: 1
  Magento_Multishipping: 1
  Magento_MysqlMq: 1
  Magento_NewRelicReporting: 1
  Magento_Review: 1
  Magento_OfflinePayments: 1
  Magento_OfflineShipping: 1
  Magento_VersionsCms: 1
  Magento_AdminGws: 1
  Magento_PaymentStaging: 1
  Magento_Paypal: 1
  Magento_Persistent: 1
  Magento_PersistentHistory: 1
  Magento_PricePermissions: 1
  Magento_GiftRegistry: 1
  Magento_ProductVideo: 1
  Magento_CatalogStaging: 1
  Magento_PromotionPermissions: 1
  Magento_Banner: 1
  Magento_QuoteAnalytics: 1
  Magento_ReleaseNotification: 1
  Magento_Reminder: 1
  Magento_ConfigurableProductStaging: 1
  Magento_RequireJs: 1
  Magento_ResourceConnections: 1
  Magento_Shipping: 1
  Magento_ReviewAnalytics: 1
  Magento_ReviewStaging: 1
  Magento_Reward: 1
  Magento_RewardStaging: 1
  Magento_Rma: 1
  Magento_RmaStaging: 1
  Magento_Robots: 1
  Magento_Rss: 1
  Magento_AdvancedSalesRule: 1
  Magento_Authorizenet: 1
  Magento_SalesAnalytics: 1
  Magento_Signifyd: 1
  Magento_SalesInventory: 1
  Magento_CustomerSegment: 1
  Magento_SalesRuleStaging: 1
  Magento_CatalogPermissions: 1
  Magento_UrlRewrite: 1
  Magento_ScalableCheckout: 1
  Magento_ScalableInventory: 1
  Magento_ScalableOms: 1
  Magento_ScheduledImportExport: 1
  Magento_Elasticsearch: 1
  Magento_SearchStaging: 1
  Magento_CustomerAnalytics: 1
  Magento_SendFriend: 1
  Dotdigitalgroup_Email: 1
  Magento_SalesArchive: 1
  Magento_Sitemap: 1
  Magento_Solr: 1
  Magento_CatalogInventoryStaging: 1
  Magento_BannerCustomerSegment: 1
  Magento_Support: 1
  Magento_Swagger: 1
  Magento_Swatches: 1
  Magento_SwatchesLayeredNavigation: 1
  Magento_GiftCardStaging: 1
  Magento_BundleStaging: 1
  Magento_TaxImportExport: 1
  Magento_GoogleTagManager: 1
  Magento_Translation: 1
  Magento_CatalogUrlRewriteStaging: 1
  Magento_Ups: 1
  Magento_SampleData: 1
  Magento_AsynchronousOperations: 1
  Magento_Usps: 1
  Magento_Variable: 1
  Magento_Braintree: 1
  Magento_Version: 1
  Magento_CatalogRuleStaging: 1
  Magento_VisualMerchandiser: 1
  Magento_Webapi: 1
  Magento_WebapiSecurity: 1
  Magento_Invitation: 1
  Magento_DownloadableStaging: 1
  Magento_WeeeStaging: 1
  Magento_CatalogWidget: 1
  Magento_ProductVideoStaging: 1
  Magento_WishlistAnalytics: 1
  Magento_Worldpay: 1
  Shopial_Facebook: 1
  Temando_Shipping: 1

# Default template data for env.php
####################################
kxlops_mage2_env_php:
  backend:
    frontName: "'{{ kxlops_mage2_env_backend_frontname }}'"
  db:
    connection:
      indexer:
        host: "'{{ kxlops_mage2_env_db_host_main }}'"
        dbname: "'{{ kxlops_mage2_env_db_main }}'"
        username: "'{{ kxlops_mage2_env_db_user_main }}'"
        password: "'{{ kxlops_mage2_env_db_password_main }}'"
        active: 1
        persistent: 'NULL'
        model: "'mysql4'"
        engine: "'innodb'"
        initStatements: "'SET NAMES utf8;'"
      default:
        host: "'{{ kxlops_mage2_env_db_host_main }}'"
        dbname: "'{{ kxlops_mage2_env_db_main }}'"
        username: "'{{ kxlops_mage2_env_db_user_main }}'"
        password: "'{{ kxlops_mage2_env_db_password_main }}'"
        active: 1
        model: "'mysql4'"
        engine: "'innodb'"
        initStatements: "'SET NAMES utf8;'"
  table_prefix: "''"
  crypt:
    key: "'{{ kxlops_mage2_env_crypt_key }}'"
  resource:
    default_setup:
      connection: "'default'"
  x-frame-options: "'SAMEORIGIN'"
  MAGE_MODE: "'{{ kxlops_mage2_env_mage_mode }}'"
  session:
    save: "'db'"
  cache_types:
    config: 1
    layout: 1
    block_html: 1
    collections: 1
    reflection: 1
    db_ddl: 1
    eav: 1
    customer_notification:  1
    target_rule: 1
    full_page: 1
    config_integration: 1
    config_integration_api: 1
    translate: 1
    config_webservice: 1
    compiled_config: 1
  install:
    date: "'{{ kxlops_mage2_env_install_date }}'"
  system:
    default:
      dev:
        js:
          session_storage_key: "'collected_errors'"
        restrict:
          allow_ips: 'NULL'
      web:
        unsecure:
          base_url: "'{{ kxlops_mage2_app_fqdn_scheme }}://{{ kxlops_mage2_app_fqdn }}/{{ kxlops_mage2_app_root }}/'"
          base_link_url: "'{% raw %}{{unsecure_base_url}}{% endraw %}'"
        secure:
          base_url: "'{{ kxlops_mage2_app_fqdn_scheme }}://{{ kxlops_mage2_app_fqdn }}/{{ kxlops_mage2_app_root }}/'"
          base_link_url: "'{% raw %}{{secure_base_url}}{% endraw %}'"

kxlops_mage2_htaccess_expires_caching: |
  ## EXPIRES CACHING ##
  <IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresByType text/x-javascript "access plus 1 month"
  ExpiresByType application/x-shockwave-flash "access plus 1 month"
  ExpiresByType image/x-icon "access plus 1 year"
  ExpiresDefault "access plus 2 days"
  </IfModule>

kxlops_mage2_htaccess_compression: |
  # Compress HTML, CSS, JavaScript, Text, XML and fonts
  <IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
  # Remove browser bugs (only needed for really old browsers)
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
  Header append Vary User-Agent
  </IfModule>